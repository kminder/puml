@startuml
title Secure Map Reduce 2 - HDFS & YARN Bootstrap
autonumber
hide footbox

'participant "Client\n(c)" as C
participant "Resource\nManager\n(rm)" as RM
participant "Node\nManager\n(nm)" as NM
'participant "Shuffle\nService\n(ss)" as SS
'participant "History\nServer\n(hs)" as HS
'participant "Application\nMaster\n(am)" as AM
'participant "Client\nService\n(cs)" as CS
'participant "Application\nContainer\n(ac)" as AC #red
'participant "Task\n(t)" as T #orange
'participant "File\nSystem\n(fs)" as FS

participant "Name\nNode\n(nn)" as NN
participant "Data\nNode\n(dn)" as DN

  'note over RM,DN #green: QUESTION: ?

== HDFS ==

'1
NN->NN: createBlockAccessTokenSecretKey()\n : blk-tkn-sk
  note left: For DNs to validate BlockAccessTokens from clients.

'2
DN->NN: register/heartbeat\n [RPC:SASL(dn-kp,nn-kp)]\n ( dn-status )\n: blk-tkn-sk
  note left: Distribute blk-tkn-sk to all DNs

== YARN ==

  note over RM,DN #green: QUESTION: Used between what components?
'3
RM->RM: createNodeManagerTokenSecretKey()\n : nm-tkn-sk
  note right: Used by TODO to validate nm-tkn from TODO.

  note over RM,DN #green: QUESTION: Used between which components?
'4
RM->RM: createAppContainerTokenSecretKey()\n : ac-tkn-sk
  note right: Used by TODO to validate ac-tkn from TODO.

'5
NM->RM: register/heartbeat\n [RPC:SASL(nm-kp,rm-kp)]\n ( nm-status )\n : nm-tkn-sk, ac-tkn-sk
  note right: Distribute nm-tkn-sk and ac-tkn-sk to all NMs

@enduml